(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function a(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=a(o);fetch(o.href,i)}})();function q(t,e,a){return new Promise(r=>{let o=indexedDB.open(t,e);o.onupgradeneeded=i=>{(i.newVersion??0>e)&&(console.log("Got Version ",i.newVersion,i.oldVersion),console.log("Reload location to update DB"),location.reload()),a(o.result),r(o.result)},o.onsuccess=()=>r(o.result),o.onerror=i=>{i.stopPropagation(),console.warn("Ignore unhandled error")}})}function T(t,e,...a){return S(t,e,(r,o)=>{let i=r.objectStore(e);r.oncomplete=()=>o();try{for(let l of a)i.add(l)}catch(l){console.error(l)}})}function V(t,e,a){return S(t,e,(r,o)=>{let i=r.objectStore(e);r.oncomplete=()=>o();try{i.put(a)}catch(l){console.error(l)}})}function S(t,e,a){return new Promise((r,o)=>{let i=t.transaction(e,"readwrite");i.onerror=l=>{l.stopPropagation(),o(2)},i.onabort=l=>l.stopPropagation(),a(i,r)})}function p(t,e,a){return new Promise((r,o)=>{let i=t.transaction(e,"readonly");i.onerror=l=>{l.stopImmediatePropagation(),o(2)},a(i,r)})}const G=1,z="STORAGE";function K(){return q(z,G,F)}function F(t){let e=t.createObjectStore("items",{keyPath:"id"});e.createIndex("name","name",{unique:!1}),e.createIndex("date","date",{unique:!1})}async function O(t,e){return await p(t,"items",((a,r)=>{let i=a.objectStore("items").get(e);console.log("Read Item for ID",e),i.onerror=()=>r(void 0),i.onsuccess=()=>{console.log("Result:",i.result),r(i.result)}}))}async function M(t){return await p(t,"items",((e,a)=>{let o=e.objectStore("items").getAll();o.onsuccess=()=>{let i=new Map,l=o.result;for(let c of l)i.set(c.name,(i.get(c.name)??0)+1);a(i)}}))}async function J(t,e){return await p(t,"items",((a,r)=>{let i=a.objectStore("items").index("name").openCursor(IDBKeyRange.only(e)),l=[];i.onsuccess=()=>{let c=i.result;c?(l.push(c.value),c.continue()):r(l)}}))}async function E(t,e){return await S(t,"items",((a,r)=>{let i=a.objectStore("items").delete(e);i.onsuccess=()=>r()}))}async function U(t){return await p(t,"items",((e,a)=>{let o=e.objectStore("items").getAll();o.onsuccess=()=>{let i=new Set,l=o.result;for(let c of l)i.add(c.name);a(i)}}))}async function H(t){return await p(t,"items",((e,a)=>{let o=e.objectStore("items").openCursor(null,"prev");o.onsuccess=()=>{let i=o.result;a(i?i.value.id+1:1)}}))}function n(t,e,a){let r=document.createElement(t);return r.innerText=a??"",e?.append(r),r}function s(t,...e){return t.classList.add(...e),t}function h(t,e){return t.role=e,t}function w(t){for(;t.hasChildNodes();)t.firstChild?.remove()}function A(t,...e){let a=n("table",t),r=n("tr",n("thead",a));for(let o of e)n("th",r,o);return n("tbody",a),a}function R(t,...e){let a=t.tBodies.item(0);a||(a=n("tbody",t));let r=n("tr",a);for(let o of e)n("td",r).append(o);return r}function _(t,e,a){let r=n("dialog"),o=n("article",r);n("p",n("header",o),`Soll der Eintrag ${t.name} mit der ID ${t.id} gelöscht werden?`);let i=s(n("div",o),"grid");return s(n("button",i,"Nein"),"secondary").onclick=()=>{r.remove(),a("details",!0)},n("button",i,"Ja").onclick=()=>{r.remove(),e.categoryOfInterest=void 0,E(e.database,t.id),a("stats",!0)},r.open=!0,r}function W(t,e,a){let r=n("dialog"),o=n("article",r);n("p",n("header",o),`Soll der Eintrag ${t.name} mit der ID ${t.id} gelöscht werden?`);let i=s(n("div",o),"grid");return s(n("button",i,"Nein"),"secondary").onclick=()=>{r.remove()},n("button",i,"Ja").onclick=()=>{r.remove(),e.categoryOfInterest=void 0,E(e.database,t.id),a()},r.open=!0,r}async function Z(t,e){console.log(e);let a=s(n("main"),"container-fluid"),r=n("nav",n("header",a));if(n("h2",r,e.categoryOfInterest),console.log("Show detailed view for",e.categoryOfInterest),n("button",r,"Zurück").onclick=()=>{history.back(),e.categoryOfInterest=void 0},!e.categoryOfInterest)return t("stats",!0),a;let o=s(A(a,"ID","Erstellungsdatum"),"striped"),i=await J(e.database,e.categoryOfInterest);i.sort((l,c)=>l.date.getTime()-c.date.getTime());for(let l of i)R(o,n("span",void 0,l.id+""),n("span",void 0,l.date.toDateString())).onclick=()=>document.body.append(_(l,e,t));return a}async function x(t,e){let a=s(n("main",document.body),"container-fluid"),r=s(n("header",a),"container");return n("h2",r,"Neuer Gegenstand"),a.appendChild(await Q(t,e)),a}async function Q(t,e){let a=n("form"),r=n("fieldset",a),o=n("input",n("label",r,"Gegenstand"));o.oninput=f,r.append(await B(e,o));let i=n("input",n("label",r,"Nummer"));i.type="number",i.oninput=f,n("button",r,"ID generieren").onclick=async u=>{u.preventDefault();let m=await H(e.database);console.log("Get next free Id: ",m),i.valueAsNumber=m,f()};let l=n("input",n("label",r,"Produktionsdatum"));l.type="date",l.valueAsDate=new Date,l.oninput=f;let c=s(n("fieldset",a),"grid"),C=s(n("button",c,"Abbrechen"),"secondary");C.onclick=u=>{u.preventDefault(),history.back()};let I=n("button",c,"Hinzufügen");I.onclick=async u=>{u.preventDefault(),await X({date:l.valueAsDate??new Date,id:i.valueAsNumber,name:o.value},e,t)},f();function f(){I.disabled=i.value==""||l.value==""||o.value==""}async function B(u,m){let D=Array.from(await U(u.database)).sort(),y=s(n("fieldset"),"autocomplete-container");m.oninput=k;function k(){w(y);let j=m.value.toLowerCase(),$=j==""?D:D.filter(g=>g.toLowerCase().match(`.*${j}.*`));for(let g of $)s(n("button",y,g),"outline","secondary").onclick=N=>{N.preventDefault(),m.value=g,f()}}return k(),y}return a}async function X(t,e,a){let r=await O(e.database,t.id);if(r)document.body.append(Y(r,t,e,a));else{await T(e.database,"items",t),a("main",!0);return}}function Y(t,e,a,r){let o=n("dialog"),i=n("article",o);n("p",n("header",i),`Der Eintrag mit der Nummer ${t.id} existiert bereits`),n("p",i,`Soll ${t.name} durch ${e.name} erstetzt werden?`);let l=s(n("div",i),"grid");return s(n("button",l,"Nein"),"secondary").onclick=()=>{o.remove(),r("edit",!0)},n("button",l,"Ja").onclick=()=>{o.remove(),r("main",!0),V(a.database,"items",e)},o.open=!0,o}function ee(t,e){console.log(e);let a=s(n("main"),"container");return n("h2",n("header",a),"Lagerhaltung"),h(n("div",a,"Suchen"),"button").onclick=()=>t("search",!1),h(n("div",a,"Gegenstand hinzufuegen"),"button").onclick=()=>t("edit",!1),h(n("div",a,"Übersicht"),"button").onclick=()=>t("stats",!1),a}async function te(t){console.log(t);let e=s(n("main"),"container"),a=n("nav",n("header",e));n("h2",a,"Suche"),n("button",a,"back").onclick=()=>history.back();let r=n("input",e);r.placeholder="Nach ID suchen",r.type="search";let o=await P(t,r.value,()=>r.value="");e.append(o),r.oninput=i;async function i(){o.remove(),o=await P(t,r.value,()=>{r.value="",i()}),e.append(o)}return e}async function P(t,e,a){let r=NaN;try{r=Number.parseInt(e)}catch(l){console.error(l)}if(isNaN(r))return n("h5",void 0,"ID zur Suche eingeben");let o=await O(t.database,r);if(!o)return n("h3",void 0,`Es liegt kein Eintrag mit der ID ${r} vor`);let i=n("div");return v("Name:",o.name,i),v("Id:",o.id+"",i),v("Erstellungsdatum:",o.date.toDateString(),i),n("button",i,"Entfernen").onclick=()=>document.body.append(W(o,t,a)),i}function v(t,e,a){let r=s(n("div",a),"grid");return n("strong",n("strong",r),t),n("span",r,e),r}async function re(t,e){console.log(e);let a=s(n("main"),"container-fluid"),r=n("nav",n("header",a));n("h2",r,"Übersicht"),n("button",r,"back").onclick=()=>history.back();let o=await M(e.database),i=s(A(a,"Name","Anzahl"),"striped");for(let l of o.keys())R(i,n("span",void 0,l),n("span",void 0,`${o.get(l)}x`)).onclick=()=>{e.categoryOfInterest=l,t("details",!1)};return console.log(o),a}document.title="Vorratshaltung";let b;async function ne(){document.body.append(L());try{b=await oe(),await d(localStorage.getItem("ui-view")||"main",!0)}catch(t){console.error(t)}window.onpopstate=ae}let d=async(t,e)=>{let a;console.log("Show View",t),w(document.body),document.body.append(L());let r=new URL(location.href);switch(r.searchParams.delete("view"),r.searchParams.append("view",t),e?history.replaceState("","",r):history.pushState("","",r),localStorage.setItem("ui-view",t),t){case"search":a=await te(b);break;case"main":a=ee(d,b);break;case"edit":a=await x(d,b);break;case"stats":a=await re(d,b);break;case"details":a=await Z(d,b);break;default:throw Error("Unsupported View "+t)}w(document.body),document.body.append(a)};async function ae(){let e=new URL(location.href).searchParams.get("view")||"main";try{d(e,!0)}catch{console.log("Failed to recover View",e,"Show main view"),d("main",!0)}}async function oe(){return{database:await K()}}function L(){let t=s(n("main"),"container");return n("article",t).setAttribute("aria-busy","true"),t}ne();
