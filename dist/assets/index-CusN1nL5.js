(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();function C(t,e,n){return new Promise(a=>{let r=indexedDB.open(t,e);r.onupgradeneeded=o=>{(o.newVersion??0>e)&&(console.log("Got Version ",o.newVersion,o.oldVersion),console.log("Reload location to update DB"),location.reload()),n(r.result),a(r.result)},r.onsuccess=()=>a(r.result),r.onerror=o=>{o.stopPropagation(),console.warn("Ignore unhandled error")}})}function T(t,e,...n){return S(t,e,(a,r)=>{let o=a.objectStore(e);a.oncomplete=()=>r();try{for(let l of n)o.add(l)}catch(l){console.error(l)}})}function B(t,e,n){return S(t,e,(a,r)=>{let o=a.objectStore(e);a.oncomplete=()=>r();try{o.put(n)}catch(l){console.error(l)}})}function S(t,e,n){return new Promise((a,r)=>{let o=t.transaction(e,"readwrite");o.onerror=l=>{l.stopPropagation(),r(2)},o.onabort=l=>l.stopPropagation(),n(o,a)})}function p(t,e,n){return new Promise((a,r)=>{let o=t.transaction(e,"readonly");o.onerror=l=>{l.stopImmediatePropagation(),r(2)},n(o,a)})}const q=1,L="STORAGE";function R(){return C(L,q,$)}function $(t){let e=t.createObjectStore("items",{keyPath:"id"});e.createIndex("name","name",{unique:!1}),e.createIndex("date","date",{unique:!1})}async function G(t,e){return await p(t,"items",((n,a)=>{let o=n.objectStore("items").get(e);console.log("Read Item for ID",e),o.onerror=()=>a(void 0),o.onsuccess=()=>{console.log("Result:",o.result),a(o.result)}}))}async function K(t){return await p(t,"items",((e,n)=>{let r=e.objectStore("items").getAll();r.onsuccess=()=>{let o=new Map,l=r.result;for(let s of l)o.set(s.name,(o.get(s.name)??0)+1);n(o)}}))}async function M(t,e){return await p(t,"items",((n,a)=>{let o=n.objectStore("items").index("name").openCursor(IDBKeyRange.only(e)),l=[];o.onsuccess=()=>{let s=o.result;s?(l.push(s.value),s.continue()):a(l)}}))}async function z(t,e){return await S(t,"items",((n,a)=>{let o=n.objectStore("items").delete(e);o.onsuccess=()=>a()}))}async function V(t){return await p(t,"items",((e,n)=>{let r=e.objectStore("items").getAll();r.onsuccess=()=>{let o=new Set,l=r.result;for(let s of l)o.add(s.name);n(o)}}))}async function F(t){return await p(t,"items",((e,n)=>{let r=e.objectStore("items").openCursor(null,"prev");r.onsuccess=()=>{let o=r.result;n(o?o.value.id+1:1)}}))}function i(t,e,n){let a=document.createElement(t);return a.innerText=n??"",e?.append(a),a}function c(t,...e){return t.classList.add(...e),t}function h(t){for(;t.hasChildNodes();)t.firstChild?.remove()}function k(t,...e){let n=i("table",t),a=i("tr",i("thead",n));for(let r of e)i("th",a,r);return i("tbody",n),n}function N(t,...e){let n=t.tBodies.item(0);n||(n=i("tbody",t));let a=i("tr",n);for(let r of e)i("td",a).append(r);return a}async function J(t,e){console.log(e);let n=c(i("main"),"container"),a=i("header",n);if(i("h2",a,e.categoryOfInterest),console.log("Show detailed view for",e.categoryOfInterest),i("button",a,"back").onclick=()=>{t("stats"),e.categoryOfInterest=void 0},!e.categoryOfInterest)return t("stats"),n;let r=c(k(n,"ID","Erstellungsdatum"),"striped"),o=await M(e.database,e.categoryOfInterest);o.sort((l,s)=>l.date.getTime()-s.date.getTime());for(let l of o)N(r,i("span",void 0,l.id+""),i("span",void 0,l.date.toDateString())).onclick=()=>document.body.append(_(l,e,t));return n}function _(t,e,n){let a=i("dialog"),r=i("article",a);i("p",i("header",r),`Soll der Eintrag ${t.name} mit der ID ${t.id} gelöscht werden?`);let o=c(i("div",r),"grid");return c(i("button",o,"Nein"),"secondary").onclick=()=>{a.remove(),n("details")},i("button",o,"Ja").onclick=()=>{a.remove(),e.categoryOfInterest=void 0,z(e.database,t.id),n("stats")},a.open=!0,a}async function x(t,e){let n=c(i("main",document.body),"container"),a=c(i("header",n),"container");return i("h2",a,"Neuer Gegenstand"),n.appendChild(await H(t,e)),n}async function H(t,e){let n=i("form"),a=i("fieldset",n),r=i("input",i("label",a,"Gegenstand"));r.oninput=d,a.append(await E(e,r));let o=i("input",i("label",a,"Nummer"));o.type="number",o.oninput=d,i("button",a,"ID generieren").onclick=async u=>{u.preventDefault();let f=await F(e.database);console.log("Get next free Id: ",f),o.valueAsNumber=f,d()};let l=i("input",i("label",a,"Produktionsdatum"));l.type="date",l.valueAsDate=new Date,l.oninput=d;let s=c(i("fieldset",n),"grid"),A=c(i("button",s,"Abbrechen"),"secondary");A.onclick=u=>{u.preventDefault(),t("main")};let w=i("button",s,"Hinzufügen");w.onclick=async u=>{u.preventDefault(),await U({date:l.valueAsDate??new Date,id:o.valueAsNumber,name:r.value},e,t)},d();function d(){w.disabled=o.value==""||l.value==""||r.value==""}async function E(u,f){let v=Array.from(await V(u.database)).sort(),y=c(i("fieldset"),"autocomplete-container");f.oninput=I;function I(){h(y);let D=f.value.toLowerCase(),P=D==""?v:v.filter(g=>g.toLowerCase().match(`.*${D}.*`));for(let g of P)c(i("button",y,g),"outline","secondary").onclick=j=>{j.preventDefault(),f.value=g,d()}}return I(),y}return n}async function U(t,e,n){let a=await G(e.database,t.id);if(a)document.body.append(W(a,t,e,n));else{await T(e.database,"items",t),n("main");return}}function W(t,e,n,a){let r=i("dialog"),o=i("article",r);i("p",i("header",o),`Der Eintrag mit der Nummer ${t.id} existiert bereits`),i("p",o,`Soll ${t.name} durch ${e.name} erstetzt werden?`);let l=c(i("div",o),"grid");return c(i("button",l,"Nein"),"secondary").onclick=()=>{r.remove(),a("edit")},i("button",l,"Ja").onclick=()=>{r.remove(),a("main"),B(n.database,"items",e)},r.open=!0,r}function Q(t,e){console.log(e);let n=c(i("main"),"container");return i("header",n,"Main"),i("button",n,"Suchen").onclick=()=>t("search"),i("button",n,"Gegenstand hinzufuegen").onclick=()=>t("edit"),i("button",n,"Übersicht").onclick=()=>t("stats"),n}function X(t,e){console.log(e);let n=c(i("main"),"container"),a=i("header",n,"Search");return i("button",a,"back").onclick=()=>t("main"),n}async function Y(t,e){console.log(e);let n=c(i("main"),"container"),a=c(i("header",n));i("h2",a,"Übersicht"),i("button",a,"back").onclick=()=>t("main");let r=await K(e.database),o=c(k(n,"Name","Anzahl"),"striped");for(let l of r.keys())N(o,i("span",void 0,l),i("span",void 0,`${r.get(l)}x`)).onclick=()=>{e.categoryOfInterest=l,t("details")};return console.log(r),n}document.title="VITE TEST";let m;async function Z(){document.body.append(O());try{m=await ee(),await b(localStorage.getItem("ui-view")||"main")}catch(t){console.error(t)}}let b=async t=>{let e;switch(console.log("Show View",t),h(document.body),document.body.append(O()),window.localStorage.setItem("ui-view",t),t){case"search":e=X(b,m);break;case"main":e=Q(b,m);break;case"edit":e=await x(b,m);break;case"stats":e=await Y(b,m);break;case"details":e=await J(b,m);break;default:throw Error("Unsupported View "+t)}h(document.body),document.body.append(e)};async function ee(){return{database:await R()}}function O(){let t=c(i("main"),"container");return i("article",t).setAttribute("aria-busy","true"),t}Z();
