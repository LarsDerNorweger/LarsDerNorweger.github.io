(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function a(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=a(i);fetch(i.href,o)}})();function q(t,e,a){return new Promise(r=>{let i=indexedDB.open(t,e);i.onupgradeneeded=o=>{(o.newVersion??0>e)&&(console.log("Got Version ",o.newVersion,o.oldVersion),console.log("Reload location to update DB"),location.reload()),a(i.result),r(i.result)},i.onsuccess=()=>r(i.result),i.onerror=o=>{o.stopPropagation(),console.warn("Ignore unhandled error",o)}})}function T(t,e,...a){return N(t,e,(r,i)=>{let o=r.objectStore(e);r.oncomplete=()=>i();try{for(let l of a)o.add(l)}catch(l){console.error(l)}})}function V(t,e,a){return N(t,e,(r,i)=>{let o=r.objectStore(e);r.oncomplete=()=>i();try{o.put(a)}catch(l){console.error(l)}})}function N(t,e,a){return new Promise((r,i)=>{let o=t.transaction(e,"readwrite");o.onerror=l=>{l.stopPropagation(),i(2)},o.onabort=l=>l.stopPropagation(),a(o,r)})}function y(t,e,a){return new Promise((r,i)=>{let o=t.transaction(e,"readonly");o.onerror=l=>{l.stopImmediatePropagation(),i(2)},a(o,r)})}const K=1,G="STORAGE";function z(){return q(G,K,F)}function F(t){let e=t.createObjectStore("items",{keyPath:"id"});e.createIndex("name","name",{unique:!1}),e.createIndex("date","date",{unique:!1})}async function A(t,e){return await y(t,"items",((a,r)=>{let o=a.objectStore("items").get(e);console.log("Read Item for ID",e),o.onerror=()=>r(void 0),o.onsuccess=()=>{console.log("Result:",o.result),r(o.result)}}))}async function M(t){return await y(t,"items",((e,a)=>{let i=e.objectStore("items").getAll();i.onsuccess=()=>{let o=new Map,l=i.result;for(let c of l)o.set(c.name,(o.get(c.name)??0)+1);a(o)}}))}async function J(t,e){return await y(t,"items",((a,r)=>{let o=a.objectStore("items").index("name").openCursor(IDBKeyRange.only(e)),l=[];o.onsuccess=()=>{let c=o.result;c?(l.push(c.value),c.continue()):r(l)}}))}async function L(t,e){return await N(t,"items",((a,r)=>{let o=a.objectStore("items").delete(e);o.onsuccess=()=>r()}))}async function U(t){return await y(t,"items",((e,a)=>{let i=e.objectStore("items").getAll();i.onsuccess=()=>{let o=new Set,l=i.result;for(let c of l)o.add(c.name);a(o)}}))}async function H(t){return await y(t,"items",((e,a)=>{let i=e.objectStore("items").openCursor(null,"prev");i.onsuccess=()=>{let o=i.result;a(o?o.value.id+1:1)}}))}function n(t,e,a){let r=document.createElement(t);return r.innerText=a??"",e?.append(r),r}function s(t,...e){return t.classList.add(...e),t}function I(t,e){return t.role=e,t}function k(t){for(;t.hasChildNodes();)t.firstChild?.remove()}function C(t,...e){let a=n("table",t),r=n("tr",n("thead",a));for(let i of e)n("th",r,i);return n("tbody",a),a}function R(t,...e){let a=t.tBodies.item(0);a||(a=n("tbody",t));let r=n("tr",a);for(let i of e)n("td",r).append(i);return r}function _(t,e,a){let r=n("dialog"),i=n("article",r);n("p",n("header",i),`Soll der Eintrag ${t.name} mit der ID ${t.id} gelöscht werden?`);let o=s(n("div",i),"grid");return s(n("button",o,"Nein"),"secondary").onclick=()=>{r.remove(),a("details",!0)},n("button",o,"Ja").onclick=()=>{r.remove(),e.categoryOfInterest=void 0,L(e.database,t.id),a("stats",!0)},r.open=!0,r}function x(t,e,a){let r=n("dialog"),i=n("article",r);n("p",n("header",i),`Soll der Eintrag ${t.name} mit der ID ${t.id} gelöscht werden?`);let o=s(n("div",i),"grid");return s(n("button",o,"Nein"),"secondary").onclick=()=>{r.remove()},n("button",o,"Ja").onclick=()=>{r.remove(),e.categoryOfInterest=void 0,L(e.database,t.id),a()},r.open=!0,r}async function W(t,e){console.log(e);let a=s(n("main"),"container-fluid"),r=n("nav",n("header",a));if(n("h2",r,e.categoryOfInterest),console.log("Show detailed view for",e.categoryOfInterest),n("button",r,"Zurück").onclick=()=>{history.back(),e.categoryOfInterest=void 0},!e.categoryOfInterest)return t("stats",!0),a;let i=s(C(a,"ID","Erstellungsdatum"),"striped"),o=await J(e.database,e.categoryOfInterest);o.sort((l,c)=>l.date.getTime()-c.date.getTime());for(let l of o)R(i,n("span",void 0,l.id+""),n("span",void 0,l.date.toDateString())).onclick=()=>document.body.append(_(l,e,t));return a}async function Z(t,e){let a=s(n("main",document.body),"container-fluid"),r=s(n("header",a),"container");return n("h2",r,"Neuer Gegenstand"),a.appendChild(await Q(t,e)),a}async function Q(t,e){let a=n("form"),r=n("fieldset",a),i=n("input",n("label",r,"Gegenstand"));i.oninput=d,r.append(await u(e,i));let o=n("input",n("label",r,"Nummer"));o.type="number",o.oninput=d,n("button",r,"ID generieren").onclick=async f=>{f.preventDefault();let p=await H(e.database);console.log("Get next free Id: ",p),o.valueAsNumber=p,d()};let l=n("input",n("label",r,"Produktionsdatum"));l.type="date",l.valueAsDate=new Date,l.oninput=d;let c=s(n("fieldset",a),"grid"),h=s(n("button",c,"Abbrechen"),"secondary");h.onclick=f=>{f.preventDefault(),history.back()};let g=n("button",c,"Hinzufügen");g.onclick=async f=>{f.preventDefault(),await X({date:l.valueAsDate??new Date,id:o.valueAsNumber,name:i.value},e,t)},d();function d(){g.disabled=o.value==""||l.value==""||i.value==""}async function u(f,p){let j=Array.from(await U(f.database)).sort(),w=s(n("fieldset"),"autocomplete-container");p.oninput=S;function S(){k(w);let P=p.value.toLowerCase(),$=P==""?j:j.filter(v=>v.toLowerCase().match(`.*${P}.*`));for(let v of $)s(n("button",w,v),"outline","secondary").onclick=O=>{O.preventDefault(),p.value=v,d(),S()}}return S(),w}return a}async function X(t,e,a){let r=await A(e.database,t.id);if(r)document.body.append(Y(r,t,e,a));else{await T(e.database,"items",t),a("main",!0);return}}function Y(t,e,a,r){let i=n("dialog"),o=n("article",i);n("p",n("header",o),`Der Eintrag mit der Nummer ${t.id} existiert bereits`),n("p",o,`Soll ${t.name} durch ${e.name} erstetzt werden?`);let l=s(n("div",o),"grid");return s(n("button",l,"Nein"),"secondary").onclick=()=>{i.remove(),r("edit",!0)},n("button",l,"Ja").onclick=()=>{i.remove(),r("main",!0),V(a.database,"items",e)},i.open=!0,i}function ee(t,e){console.log(e);let a=s(n("main"),"container");return n("h2",n("header",a),"Lagerhaltung"),I(n("div",a,"Suchen"),"button").onclick=()=>t("search",!1),I(n("div",a,"Gegenstand hinzufuegen"),"button").onclick=()=>t("edit",!1),I(n("div",a,"Übersicht"),"button").onclick=()=>t("stats",!1),a}async function te(t){console.log(t);let e=s(n("main"),"container"),a=n("nav",n("header",e));n("h2",a,"Suche"),n("button",a,"back").onclick=()=>history.back();let r=n("input",e);r.placeholder="Nach ID suchen",r.type="search";let i=await E(t,r.value,()=>r.value="");e.append(i),r.oninput=o;async function o(){i.remove(),i=await E(t,r.value,()=>{r.value="",o()}),e.append(i)}return e}async function E(t,e,a){let r=NaN;try{r=Number.parseInt(e)}catch(l){console.error(l)}if(isNaN(r))return n("h5",void 0,"ID zur Suche eingeben");let i=await A(t.database,r);if(!i)return n("h3",void 0,`Es liegt kein Eintrag mit der ID ${r} vor`);let o=n("div");return D("Name:",i.name,o),D("Id:",i.id+"",o),D("Erstellungsdatum:",i.date.toDateString(),o),n("button",o,"Entfernen").onclick=()=>document.body.append(x(i,t,a)),o}function D(t,e,a){let r=s(n("div",a),"grid");return n("strong",n("strong",r),t),n("span",r,e),r}async function re(t,e){console.log(e);let a=s(n("main"),"container-fluid"),r=n("nav",n("header",a));n("h2",r,"Übersicht"),n("button",r,"back").onclick=()=>history.back();let i=await M(e.database),o=n("input",a);o.placeholder="Nach Begriff filtern",o.type="search",o.oninput=h;let l=s(C(a,"Name","Anzahl"),"striped"),c=[...i.keys()].sort();function h(){for(let u of l.tBodies)u.remove();let g=o.value.toLowerCase(),d=g==""?c:c.filter(u=>u.toLowerCase().match(`.*${g}.*`));for(let u of d)R(l,n("span",void 0,u),n("span",void 0,`${i.get(u)}x`)).onclick=()=>{e.categoryOfInterest=u,t("details",!1)}}return console.log(i),h(),a}document.title="Vorratshaltung";let b;async function ne(){document.body.append(B());try{b=await oe(),await m("main",!0)}catch(t){console.error(t)}window.onpopstate=ae}let m=async(t,e)=>{let a;console.log("Show View",t),k(document.body),document.body.append(B());let r=new URL(location.href);switch(r.searchParams.delete("view"),r.searchParams.append("view",t),e?history.replaceState("","",r):history.pushState("","",r),localStorage.setItem("ui-view",t),t){case"search":a=await te(b);break;case"main":a=ee(m,b);break;case"edit":a=await Z(m,b);break;case"stats":a=await re(m,b);break;case"details":a=await W(m,b);break;default:throw Error("Unsupported View "+t)}k(document.body),document.body.append(a)};async function ae(){let e=new URL(location.href).searchParams.get("view")||"main";try{m(e,!0)}catch{console.log("Failed to recover View",e,"Show main view"),m("main",!0)}}async function oe(){return{database:await z()}}function B(){let t=s(n("main"),"container");return n("article",t).setAttribute("aria-busy","true"),t}ne();
